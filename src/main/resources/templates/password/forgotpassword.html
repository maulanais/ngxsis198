<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Forget Password Form</title>
<link rel="stylesheet" href="../styles/css/bootstrap.min.css">
<link rel="stylesheet" href="../styles/css/forgotpassword.css">
<script type="text/javascript" src="../scripts/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="../scripts/changepassword.js"></script>
<script type="text/javascript" src="../scripts/jquery.md5.js"></script>
<script type="text/javascript" src="../styles/js/bootstrap.min.js"></script>
</head>


<body>

<form id="form-forgotpassword" th:action="@{~/forgotpassword/save}" th:object="${addrbook}"  method="POST">
<div class="container head1 ">
<div class="col-sm-12 ">
<h4 id="form-titleforgotpassword">Form Lupa Password</h4>
</div>
</div>

<div class="container body1">
<div class="row baris2">
<div class="col-sm-6 col-sm-offset-3">
<input type="hidden" th:field="*{id}" />
<input type="password" class=" form-control" th:field="*{abpwd}"  id="password1" placeholder="New Password" autocomplete="off" maxlength="16">

<input type="password" class=" form-control" id="password2" placeholder="Re-Type New Password" autocomplete="off" maxlength="16">

<button input type="submit" class="col-xs-12  btn-lg" id="idSubmitPassword" >Submit</button>
</div><!--/col-sm-6-->

<footer>
<p class="col-md-12" align="center" id="idFooterXsisMitraUtama">
	2019 - Xsis Mitra Utama
</p>
</footer>
</div><!--/row-->
</div>
</form>


<script>


$(document).ready(function() {
	
	
	$("#form-forgotpassword").on('submit', function(){
		
	    var ucase = new RegExp("[A-Z]+");
		var lcase = new RegExp("[a-z]+");
		var num = new RegExp("[0-9]+");
		var symbl = new RegExp("[\x21-\x2F \x3A-\x40 \x5B-\x60]+");
		
		
		
		if( !$("#password1").val()) {
			debugger;
			alert("Password Tidak Boleh Kosong");
			event.preventDefault();
		}
		
		else if($('#password1').val().trim()== "")
		{
			alert("Password tidak boleh diisi spasi saja!");
			event.preventDefault();
		}
		
		else if($("#password1").val().length < 8){
			debugger
			alert("Password Tidak Boleh kurang dari 8 Karakter");
			event.preventDefault();
		}
		
		else if($("#password1").val().length >= 8){

			if(num.test($("#password1").val())== false){
				
				if(ucase.test($("#password1").val())== false){
					
					if(lcase.test($("#password1").val())== false){
						debugger;
						alert("Password Minimal ada 1 karakter Angka ,1 Karakter Huruf Besar,dan 1 Karakter Huruf Kecil");
						event.preventDefault();	
					}
					
					else if(symbl.test($("#password1").val())== false){
						debugger;
						alert("Password Minimal ada 1 karakter Angka ,1 Karakter Huruf Besar,dan 1 Karakter Simbol");
						event.preventDefault();	
					}
					else{
						debugger;
						alert("Password Minimal ada 1 karakter Angka dan 1 Karakter Huruf Besar");
						event.preventDefault();	
					}
					
				}
				
				else if(lcase.test($("#password1").val())== false){
					
					if(symbl.test($("#password1").val())== false){
						debugger;
						alert("Password Minimal ada 1 karakter Angka ,1 Karakter Huruf Kecil,dan 1 Karakter Simbol");
						event.preventDefault();	
					}
					
					else{
						debugger;
						alert("Password Minimal ada 1 karakter Angka dan 1 Karakter Huruf Kecil");
						event.preventDefault();	
					}

				}
				
				else if(symbl.test($("#password1").val())== false){
					debugger;
					alert("Password Minimal ada 1 karakter Angka dan 1 Karakter Simbol");
					event.preventDefault();	
				}
				
				else{
					debugger;
					alert("Password Minimal ada 1 karakter Angka");
					event.preventDefault();	
				}
				
			}
			
 			else if(ucase.test($("#password1").val())== false){
				
				if(lcase.test($("#password1").val())== false){
					
					if(symbl.test($("#password1").val())== false){
						debugger;
						alert("Password Minimal ada 1 karakter Huruf Besar ,1 Karakter Huruf Kecil dan 1 Karakter Simbol");
						event.preventDefault();	
					}
					
					else{
					debugger;
					alert("Password Minimal ada 1 karakter Huruf Besar dan 1 Karakter Huruf Kecil");
					event.preventDefault();
					}
				}
				
				else if(symbl.test($("#password1").val())== false){
					debugger;
					alert("Password Minimal ada 1 karakter Huruf Besar dan 1 Karakter Simbol");
					event.preventDefault();	
				}
				
				else{
					debugger;
					alert("Password Minimal ada 1 karakter Huruf Besar");
					event.preventDefault();	
				}
			}
			
			else if(lcase.test($("#password1").val())== false){
				
				if(symbl.test($("#password1").val())== false){
					debugger;
					alert("Password Minimal ada 1 karakter Huruf Kecil dan 1 Karakter Simbol");
					event.preventDefault();	
				}
				
				else{
				debugger;
				alert("Password Minimal ada 1 Karakter Huruf Kecil");
				event.preventDefault();	
				}
			}
			
 			else if(symbl.test($("#password1").val())== false){
					
				debugger;
				alert("Password Minimal ada 1 Karakter Simbol");
				event.preventDefault();
			}    
			
			
			else if($("#password1").val() != $("#password2").val()){
				debugger;
				alert("Password tidak sama, pastikan anda memasukkan password yang sama.");
				event.preventDefault();
			}
			
			else{
				debugger;
				event.preventDefault();
				
				$("input[type='password']").each(function(){
					$(this).val(jQuery.md5($(this).val()));
				});
				var url = $(this).attr('action');
				var urlredir= 'http://localhost:8585/'
				debugger;

				// datakan data form dengan method serialize
				var data = $(this).serialize();
				$.ajax({
					url:url,
					type:'POST',
					data : data,
					dataType:'html',
					success:function(data){
						debugger;
						alert("Berhasil ubah password, silakan coba login kembali");
						window.location.replace(urlredir);
					},
					error: function(model){
						debugger;
					}
				});
			}
		}
	});
	
	
});
</script>


</body>
</html>